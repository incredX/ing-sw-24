


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Game</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">IS24_LB11.game</a>
</div>

<h1>Coverage Summary for Class: Game (IS24_LB11.game)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Game</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    52,6%
  </span>
  <span class="absValue">
    (10/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    52,9%
  </span>
  <span class="absValue">
    (54/102)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package IS24_LB11.game;
&nbsp;
&nbsp;import IS24_LB11.game.components.GoalCard;
&nbsp;import IS24_LB11.game.components.JsonConvertable;
&nbsp;import IS24_LB11.game.components.PlayableCard;
&nbsp;import IS24_LB11.game.components.StarterCard;
&nbsp;import IS24_LB11.game.symbol.Symbol;
&nbsp;import IS24_LB11.game.tools.JsonConverter;
&nbsp;import IS24_LB11.game.tools.JsonException;
&nbsp;import IS24_LB11.game.utils.Color;
&nbsp;import IS24_LB11.game.utils.Position;
&nbsp;import IS24_LB11.game.symbol.*;
&nbsp;import IS24_LB11.game.utils.SyntaxException;
&nbsp;
&nbsp;import java.io.FileNotFoundException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static IS24_LB11.game.GameMessages.*;
&nbsp;
&nbsp;public class Game {
&nbsp;    private boolean finalTurn;
&nbsp;    private boolean gameEnded;
&nbsp;    private int turn;
&nbsp;    private int lastTurn;
&nbsp;    private final int numPlayers;
&nbsp;    private final Deck goalDeck;
&nbsp;    private final Deck goldenDeck;
&nbsp;    private final Deck normalDeck;
&nbsp;    private final Deck starterDeck;
&nbsp;    private final ArrayList&lt;Player&gt; players;
&nbsp;    private ArrayList&lt;Player&gt; finalRanking;
&nbsp;    private ArrayList&lt;GoalCard&gt; publicGoals;
&nbsp;
<b class="fc">&nbsp;    public Game(int numPlayers) throws SyntaxException, FileNotFoundException, DeckException {</b>
<b class="fc">&nbsp;        JsonConverter jsonConverter = new JsonConverter();</b>
<b class="fc">&nbsp;        this.turn = 0;</b>
<b class="fc">&nbsp;        this.numPlayers = numPlayers;</b>
<b class="fc">&nbsp;        this.goalDeck = jsonConverter.JSONToDeck(&#39;O&#39;); // &lt;- here we load the deck from json</b>
<b class="fc">&nbsp;        this.goldenDeck = jsonConverter.JSONToDeck(&#39;G&#39;); // &lt;- here we load deck from json</b>
<b class="fc">&nbsp;        this.normalDeck = jsonConverter.JSONToDeck(&#39;N&#39;); // &lt;- here we load deck from json</b>
<b class="fc">&nbsp;        this.starterDeck = jsonConverter.JSONToDeck(&#39;S&#39;); // &lt;- here we load deck from json</b>
<b class="fc">&nbsp;        publicGoals = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        goalDeck.shuffle();</b>
<b class="fc">&nbsp;        publicGoals.add((GoalCard) goalDeck.drawCard());</b>
<b class="fc">&nbsp;        publicGoals.add((GoalCard)goalDeck.drawCard());</b>
<b class="fc">&nbsp;        this.players = new ArrayList&lt;&gt;(numPlayers);</b>
<b class="fc">&nbsp;        this.finalTurn = false;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    public Player currentPlayer() {
<b class="fc">&nbsp;        return players.get(turn % players.size());</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setupPlayer(String name) throws DeckException {
<b class="fc">&nbsp;        GoalCard[] goalCards = new GoalCard[]{</b>
<b class="fc">&nbsp;                (GoalCard) goalDeck.drawCard(),</b>
<b class="fc">&nbsp;                (GoalCard) goalDeck.drawCard()</b>
&nbsp;        };
<b class="fc">&nbsp;        ArrayList&lt;PlayableCard&gt; playerHand = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        playerHand.add((PlayableCard) normalDeck.drawCard());</b>
<b class="fc">&nbsp;        playerHand.add((PlayableCard) normalDeck.drawCard());</b>
<b class="fc">&nbsp;        playerHand.add((PlayableCard) goldenDeck.drawCard());</b>
<b class="fc">&nbsp;        PlayerSetup playerSetup = new PlayerSetup((StarterCard) starterDeck.drawCard(), goalCards, playerHand, Color.fromInt(players.size()));</b>
<b class="fc">&nbsp;        players.add(new Player(name, playerSetup));</b>
&nbsp;    }
&nbsp;
&nbsp;    public String setupGame(ArrayList&lt;String&gt; playerNames) throws DeckException {
<b class="fc">&nbsp;        if (playerNames.size() != numPlayers) return NAMES_OUT_OF_BOUND;</b>
<b class="fc">&nbsp;        goalDeck.shuffle();</b>
<b class="fc">&nbsp;        goldenDeck.shuffle();</b>
<b class="fc">&nbsp;        normalDeck.shuffle();</b>
<b class="fc">&nbsp;        starterDeck.shuffle();</b>
<b class="fc">&nbsp;        for (String name : playerNames)</b>
<b class="fc">&nbsp;            setupPlayer(name);</b>
<b class="fc">&nbsp;        return GameMessages.SETUP_COMPLETE;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String chooseGoalPhase(ArrayList&lt;GoalCard&gt; playersGoalCardChoosen, ArrayList&lt;StarterCard&gt; starterCardFacePosition) {
&nbsp;        //not cheking if goal card not present in player hand
<b class="fc">&nbsp;        for (Player player : players) {</b>
<b class="fc">&nbsp;            for (GoalCard goalCard : playersGoalCardChoosen) {</b>
<b class="fc">&nbsp;                if (player.getSetup().selectGoal(goalCard))</b>
<b class="fc">&nbsp;                    break;</b>
<b class="fc">&nbsp;            }</b>
<b class="fc">&nbsp;            for (StarterCard starterCard:starterCardFacePosition)</b>
<b class="fc">&nbsp;                if(numberCharNotEqualInSamePosition(player.getSetup().getStarterCard().asString(),starterCard.asString()))</b>
<b class="fc">&nbsp;                    if (player.getSetup().getStarterCard().asString().charAt(6)!=starterCard.asString().charAt(6))</b>
<b class="nc">&nbsp;                        player.getSetup().flipStarterCard();</b>
<b class="fc">&nbsp;            player.applySetup();</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return GOAL_PHASE_COMPLETED;</b>
&nbsp;    }
&nbsp;
&nbsp;    //Check if is not player turn
&nbsp;    public String executeTurn(String playerName, Position position, PlayableCard playableCard, boolean deckType, int indexDeck) throws JsonException, DeckException, SyntaxException {
<b class="fc">&nbsp;        if (playerName.compareTo(currentPlayer().name()) != 0) return NOT_PLAYER_TURN;</b>
<b class="fc">&nbsp;        if (hasGameEnded()) return GAME_ENDED;</b>
<b class="fc">&nbsp;        return finalTurn ? executeFinalTurn(position,playableCard) : executeNormalTurn(position, playableCard, deckType, indexDeck);</b>
&nbsp;    }
&nbsp;
&nbsp;    private String executeNormalTurn(Position position, PlayableCard playableCard, boolean deckType, int indexDeck) throws DeckException, JsonException, SyntaxException {
<b class="fc">&nbsp;        Player player = currentPlayer();</b>
<b class="fc">&nbsp;        if (normalDeck.isEmpty() &amp;&amp; deckType == false)</b>
<b class="nc">&nbsp;            return CANT_DRAW_FROM_NORMAL_DECK_IS_EMPTY;</b>
<b class="fc">&nbsp;        if (goldenDeck.isEmpty() &amp;&amp; deckType == true)</b>
<b class="nc">&nbsp;            return CANT_DRAW_FROM_GOLDEN_DECK_IS_EMPTY;</b>
<b class="fc">&nbsp;        if ((!deckType &amp;&amp; normalDeck.getCards().size() - indexDeck &lt; 0 )|| (deckType &amp;&amp; goldenDeck.getCards().size() - indexDeck &lt; 0) || indexDeck &lt; 1 || indexDeck &gt; 3)</b>
<b class="fc">&nbsp;            return INDEX_DECK_WRONG;</b>
<b class="nc">&nbsp;        if (player.placeCard(playableCard, position) == false)</b>
<b class="nc">&nbsp;            return INVALID_POSITION_CARD_OR_NOT_IN_HAND;</b>
&nbsp;        else {
<b class="nc">&nbsp;            player.incrementScoreLastCardPlaced();</b>
&nbsp;        }
&nbsp;        //0 for standard deck, 1 for gold deck
&nbsp;        //deck empty o provo a pescare una carta non esistente
<b class="nc">&nbsp;        if (!deckType)</b>
<b class="nc">&nbsp;            player.addCardToHand((PlayableCard) normalDeck.drawCard(indexDeck));</b>
<b class="nc">&nbsp;        else if (deckType)</b>
<b class="nc">&nbsp;            player.addCardToHand((PlayableCard) goldenDeck.drawCard(indexDeck));</b>
<b class="nc">&nbsp;        turn++;</b>
&nbsp;        //controllo se turno finale lo faccio solo sull&#39;ultima persona controllando tutti i punteggi
<b class="nc">&nbsp;        if (!finalTurn)</b>
<b class="nc">&nbsp;            isFinalTurn();</b>
<b class="nc">&nbsp;        return VALID_TURN;</b>
&nbsp;    }
&nbsp;
&nbsp;    private String executeFinalTurn(Position position, PlayableCard playableCard) throws JsonException, SyntaxException {
<b class="nc">&nbsp;        if ((turn+1) &gt; lastTurn) {</b>
<b class="nc">&nbsp;            return GAME_ENDED;</b>
&nbsp;        }
<b class="nc">&nbsp;        Player player = players.get(turn % players.size());</b>
<b class="nc">&nbsp;        if (player.placeCard(playableCard, position) == false)</b>
<b class="nc">&nbsp;            return INVALID_POSITION_CARD_OR_NOT_IN_HAND;</b>
&nbsp;        else {
<b class="nc">&nbsp;            player.incrementScoreLastCardPlaced();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        turn++;</b>
&nbsp;
<b class="nc">&nbsp;        if(turn == lastTurn) {</b>
<b class="nc">&nbsp;            gameEnded=true;</b>
<b class="nc">&nbsp;            finalRanking = finalGamePhase();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return VALID_LAST_TURN;</b>
&nbsp;    }
&nbsp;    //remind to check if front or back
&nbsp;    private void isFinalTurn() {
<b class="nc">&nbsp;        if (turn % players.size() == 0 &amp;&amp; finalTurn == false) {</b>
<b class="nc">&nbsp;            if (normalDeck.isEmpty() &amp;&amp; goldenDeck.isEmpty()){</b>
<b class="nc">&nbsp;                finalTurn = true;</b>
<b class="nc">&nbsp;            lastTurn = turn + players.size();</b>
&nbsp;            }
<b class="nc">&nbsp;            for (Player player : players)</b>
<b class="nc">&nbsp;                if (player.getScore() &gt;= 20) {</b>
<b class="nc">&nbsp;                    finalTurn = true;</b>
<b class="nc">&nbsp;                    lastTurn = turn + players.size();</b>
&nbsp;                }
&nbsp;        }
&nbsp;    }
&nbsp;    private ArrayList&lt;Player&gt; finalGamePhase() throws SyntaxException {
<b class="nc">&nbsp;        ArrayList&lt;Player&gt; ranking = players;</b>
<b class="nc">&nbsp;        for (Player player: ranking) {</b>
<b class="nc">&nbsp;            player.personalGoalScore();</b>
<b class="nc">&nbsp;            player.publicGoalScore(publicGoals);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        ranking.sort((a,b)-&gt;Integer.compare(b.getScore(), a.getScore()));</b>
<b class="nc">&nbsp;        return ranking;</b>
&nbsp;    }
&nbsp;    private boolean numberCharNotEqualInSamePosition(String s1, String s2){
<b class="fc">&nbsp;        return s1.regionMatches(0,s2,0,6) &amp;&amp; s1.regionMatches(7,s2,7,7);</b>
&nbsp;    }
&nbsp;    //ONLY FOR TESTS
&nbsp;    public ArrayList&lt;Player&gt; getPlayers() {
<b class="fc">&nbsp;        return players;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getTurn() {
<b class="nc">&nbsp;        return turn;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getFinalTurn() {
<b class="nc">&nbsp;        return finalTurn;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Deck getGoldenDeck() {
<b class="nc">&nbsp;        return goldenDeck;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Deck getNormalDeck() {
<b class="nc">&nbsp;        return normalDeck;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasGameEnded() {
<b class="fc">&nbsp;        return gameEnded;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ArrayList&lt;Player&gt; getFinalRanking(){
<b class="nc">&nbsp;        if (hasGameEnded())</b>
<b class="nc">&nbsp;            return finalRanking;</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ArrayList&lt;GoalCard&gt; getPublicGoals() {
<b class="nc">&nbsp;        return publicGoals;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-25 15:23</div>
</div>
</body>
</html>
